{% extends "base.html" %}
{% block title %}机器人管理{% endblock %}
{% block content %}
<div class="layout-content">
    <div class="layout-left">
        <div class="layout-inner-left" style="width:100% !important;">
            <div class="panel control-pages">
                <div class="panel-title">机器人管理</div>
                <div class="chart-wrap" style="padding:.12rem;">
                    <div style="display:flex; gap:.1rem; margin-bottom:.12rem;">
                        <input id="newDeviceId" placeholder="设备ID"
                            style="flex:1; padding:.06rem; background:rgba(6,20,34,.3); border:1px solid rgba(60,92,130,.25); color:#a5bcd0;" />
                        <input id="newName" placeholder="名称"
                            style="flex:1; padding:.06rem; background:rgba(6,20,34,.3); border:1px solid rgba(60,92,130,.25); color:#a5bcd0;" />
                        <button id="addRobotBtn" style="padding:.06rem;">添加</button>
                    </div>

                    <div style="overflow:auto; max-height:520px;">
                        <table style="width:100%; color:#a5bcd0; border-collapse:collapse;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>设备ID</th>
                                    <th>名称</th>
                                    <th>状态</th>
                                    <th>电量</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="robotTableBody">
                                {% for r in robots %}
                                <tr data-id="{{ r.id }}">
                                    <td>{{ r.id }}</td>
                                    <td>{{ r.device_id }}</td>
                                    <td>{{ r.name }}</td>
                                    <td class="col-status">{{ r.status }}</td>
                                    <td class="col-battery">{{ r.battery|default('-') }}</td>
                                    <td class="col-ip">{{ r.ip_address|default('-') }}</td>
                                    <td class="col-last">{{ r.last_heartbeat|default('-') }}</td>
                                    <td class="col-actions">
                                        <a class="btn-operate" href="{{ url_for('web_bp.robot_control', id=r.id) }}">操作</a>
                                        <button class="btn-delete">删除</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="layout-center">
        <div class="panel map-main">
            <div class="panel-title">机器人实时地图</div>
            <div class="chart-wrap map-wrap">
                <div class="map-box">
                    <div id="robotMap" style="width:100%; height:100%; min-height:520px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/robot_admin.js') }}"></script>
{% endblock %}