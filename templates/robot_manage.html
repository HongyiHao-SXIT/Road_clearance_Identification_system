{% extends "base.html" %}
{% block content %}
<div class="card">
    <h3>ğŸ¤– æœºå™¨äººé›†ç¾¤ç›‘æ§</h3>
    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead style="background: #f8fafc;">
            <tr>
                <th>åç§°/ID</th>
                <th>å½“å‰çŠ¶æ€</th>
                <th>å½“å‰ä½ç½®</th>
                <th>æœ€åé€šè®¯</th>
                <th>æ§åˆ¶é¢æ¿</th>
            </tr>
        </thead>
        <tbody>
            {% for r in robots %}
            <tr style="border-bottom: 1px solid #eee;">
                <td><b>{{ r.name }}</b><br><small>{{ r.device_id }}</small></td>
                <td>
                    {% if r.status == 'ONLINE' %}
                    <span class="badge" style="background: #dcfce7; color: #166534;">åœ¨çº¿</span>
                    {% else %}
                    <span class="badge" style="background: #f1f5f9; color: #64748b;">ç¦»çº¿</span>
                    {% endif %}
                </td>
                <td>{{ r.robot_position or "æœªçŸ¥" }}</td>
                <td>{{ r.last_heartbeat }}</td>
                <td>
                    <button class="btn" onclick="openRemoteControl({{ r.id }})">è¿œç¨‹æ§åˆ¶</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function openRemoteControl(id) {
    // è¿™é‡Œå¯ä»¥å¼¹å‡ºä¸€ä¸ªæ¨¡æ€æ¡†ï¼Œç”¨äºä¿®æ”¹ r.config é‡Œçš„å†…å®¹
    const newThreshold = prompt("è®¾ç½®æ–°çš„æ£€æµ‹é˜ˆå€¼ (0.1 - 1.0):", "0.5");
    if(newThreshold) {
        fetch('/api/robot/update_config', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id: id, config: {confidence_threshold: parseFloat(newThreshold)}})
        }).then(res => res.json()).then(data => {
            if(data.ok) alert('é…ç½®å·²ä¸‹å‘');
        });
    }
}
</script>
{% endblock %}