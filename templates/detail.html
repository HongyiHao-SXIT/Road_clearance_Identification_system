{% extends "base.html" %}
{% block content %}
<div class="detail-container" style="display: flex; gap: 20px; padding: 20px; flex-wrap: wrap;">
    
    <div class="image-section" style="flex: 2; min-width: 400px; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);">
        <h3 style="margin-top: 0; color: #1e293b;">è¯†åˆ«ç»“æœé¢„è§ˆ</h3>
        {% if task.result_path %}
            <img src="/{{ task.result_path }}" style="width: 100%; border-radius: 8px; border: 1px solid #e2e8f0;" alt="æ£€æµ‹ç»“æœ">
        {% else %}
            <div style="padding: 100px; text-align: center; background: #f8fafc; color: #94a3b8;">æš‚æ— ç»“æœå›¾</div>
        {% endif %}
    </div>

    <div class="info-section" style="flex: 1; min-width: 300px;">
        <div class="card" style="background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); position: sticky; top: 20px;">
            <h3 style="margin-top: 0; color: #2563eb; border-bottom: 2px solid #eff6ff; padding-bottom: 12px;">ä»»åŠ¡è¯¦æƒ… #{{ task.id }}</h3>
            
            <div class="info-group" style="margin: 16px 0; font-size: 14px; line-height: 2;">
                <p><b>ğŸ“ è¯¦ç»†åœ°å€:</b> <span style="color: #475569;">{{ task.location or "æœªçŸ¥åœ°ç‚¹" }}</span></p>
                <p><b>ğŸŒ ç²¾ç¡®åæ ‡:</b> <code style="background: #f1f5f9; padding: 2px 4px;">{{ task.latitude }}, {{ task.longitude }}</code></p>
                <p><b>â° æ£€æµ‹æ—¶é—´:</b> {{ task.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                <p><b>ğŸ“Š ä»»åŠ¡çŠ¶æ€:</b> <span class="badge" style="background: #dcfce7; color: #166534;">{{ task.status }}</span></p>
            </div>

            <hr style="border: 0; border-top: 1px solid #f1f5f9; margin: 20px 0;">

            <h4 style="margin-bottom: 12px;">è¯†åˆ«ç»†èŠ‚ ({{ items|length }} ä¸ªç›®æ ‡):</h4>
            <div class="items-list" style="max-height: 300px; overflow-y: auto;">
                {% for item in items %}
                <div style="background: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #ef4444;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <b style="color: #1e293b;">{{ item.label }}</b>
                        <span style="color: #ef4444; font-weight: bold;">{{ (item.confidence * 100)|round(1) }}%</span>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div style="margin-top: 24px; display: flex; gap: 12px;">
                <a href="{{ url_for('web_bp.result') }}" class="btn2" style="flex: 1; text-align: center; background: #64748b; color: white; text-decoration: none; padding: 10px; border-radius: 6px;">è¿”å›åˆ—è¡¨</a>
                <button onclick="handleDelete({{ task.id }})" style="flex: 1; background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; padding: 10px; border-radius: 6px; cursor: pointer;">åˆ é™¤è®°å½•</button>
            </div>
        </div>
    </div>
</div>

<script>
function handleDelete(id) {
    if (confirm('ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¿™æ¡è¯†åˆ«è®°å½•åŠå…¶å…³è”å›¾ç‰‡å—ï¼Ÿ')) {
        fetch(`/api/task/delete/${id}`, { method: 'POST' })
            .then(res => res.json())
            .then(data => {
                if (data.ok) {
                    window.location.href = '/result';
                } else {
                    alert('åˆ é™¤å¤±è´¥ï¼š' + data.message);
                }
            });
    }
}
</script>
{% endblock %}